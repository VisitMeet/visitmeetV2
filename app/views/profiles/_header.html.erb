<%= render 'components/card', class: 'overflow-hidden' do %>
  <div class="relative">
    <% if is_own_profile %>
      <%= form_with model: user, url: profile_cover_path, method: :patch, local: true, html: { multipart: true, class: 'group', data: { controller: 'cover-image', action: 'dragover->cover-image#dragOver drop->cover-image#drop' } } do |f| %>
        <% if user.respond_to?(:cover_image) && user.cover_image.attached? %>
          <%= image_tag user.cover_image, class: "w-full h-32 sm:h-48 object-cover" %>
        <% else %>
          <div class="w-full h-32 sm:h-48 bg-gray-200 dark:bg-gray-700"></div>
        <% end %>
        <div class="absolute inset-0 flex items-center justify-center text-white text-xs sm:text-sm bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer" data-action="click->cover-image#select">
          Click or drag to change cover
        </div>
        <%= f.file_field :cover_image, class: "hidden", data: { 'cover-image-target': 'input', action: 'change->cover-image#change' } %>
      <% end %>
    <% else %>
      <% if user.respond_to?(:cover_image) && user.cover_image.attached? %>
        <%= image_tag user.cover_image, class: "w-full h-32 sm:h-48 object-cover" %>
      <% else %>
        <div class="w-full h-32 sm:h-48 bg-gray-200 dark:bg-gray-700"></div>
      <% end %>
    <% end %>
    <div class="absolute left-1/2 bottom-0 transform -translate-x-1/2 translate-y-1/2">
      <div class="relative">
        <% if user.profile_picture.attached? %>
          <%= image_tag user.profile_picture.variant(resize_to_fill: [128, 128]), class: "w-32 h-32 rounded-full object-cover border-4 border-white dark:border-gray-800" %>
        <% else %>
          <div class="w-32 h-32 rounded-full bg-blue-500 text-white flex items-center justify-center text-3xl font-bold border-4 border-white dark:border-gray-800">
            <%= user.initials %>
          </div>
        <% end %>
        <% if is_own_profile %>
          <%= form_with model: user, url: update_picture_profile_path, method: :patch, local: true, html: { multipart: true }, class: "absolute inset-0 rounded-full overflow-hidden flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity bg-black bg-opacity-60" do |f| %>
            <%= f.file_field :profile_picture, class: "absolute inset-0 opacity-0 cursor-pointer" %>
            <span class="text-white text-sm">Change</span>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="pt-16 pb-6 text-center px-6">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100"><%= user.display_name %></h1>
    <p class="text-gray-500 dark:text-gray-400">@<%= user.username %></p>
    <% if user.try(:country).present? %>
      <p class="text-gray-500 dark:text-gray-400 mt-1"><%= Carmen::Country.coded(user.country).name %></p>
    <% end %>
    <div class="flex justify-center space-x-6 mt-4">
      <div class="text-center">
        <p class="text-lg font-semibold text-gray-900 dark:text-gray-100"><%= user.followers.count %></p>
        <p class="text-sm text-gray-500 dark:text-gray-400">Followers</p>
      </div>
      <div class="text-center">
        <p class="text-lg font-semibold text-gray-900 dark:text-gray-100"><%= user.following.count %></p>
        <p class="text-sm text-gray-500 dark:text-gray-400">Following</p>
      </div>
    </div>
  </div>
<% end %>

